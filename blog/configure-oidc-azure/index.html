<!doctype html>
<html lang="ja-JP" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">GitHub Actions から OpenID Connect で Azure に接続する設定作業を Terraform で自動化する | ks6088ts</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://github.com/ks6088ts.png"><meta data-rh="true" name="twitter:image" content="https://github.com/ks6088ts.png"><meta data-rh="true" property="og:url" content="https://ks6088ts.github.io/blog/configure-oidc-azure"><meta data-rh="true" property="og:locale" content="ja_JP"><meta data-rh="true" property="og:locale:alternate" content="en_US"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="GitHub Actions から OpenID Connect で Azure に接続する設定作業を Terraform で自動化する | ks6088ts"><meta data-rh="true" name="description" content="Microsoft Azure Tech Advent Calendar 2024 の 12/13 の投稿記事です。"><meta data-rh="true" property="og:description" content="Microsoft Azure Tech Advent Calendar 2024 の 12/13 の投稿記事です。"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-12-13T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/ks6088ts"><meta data-rh="true" property="article:tag" content="azure,terraform,github"><link data-rh="true" rel="icon" href="https://github.com/ks6088ts.png"><link data-rh="true" rel="canonical" href="https://ks6088ts.github.io/blog/configure-oidc-azure"><link data-rh="true" rel="alternate" href="https://ks6088ts.github.io/blog/configure-oidc-azure" hreflang="ja-JP"><link data-rh="true" rel="alternate" href="https://ks6088ts.github.io/en/blog/configure-oidc-azure" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://ks6088ts.github.io/blog/configure-oidc-azure" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://ks6088ts.github.io/blog/configure-oidc-azure","mainEntityOfPage":"https://ks6088ts.github.io/blog/configure-oidc-azure","url":"https://ks6088ts.github.io/blog/configure-oidc-azure","headline":"GitHub Actions から OpenID Connect で Azure に接続する設定作業を Terraform で自動化する","name":"GitHub Actions から OpenID Connect で Azure に接続する設定作業を Terraform で自動化する","description":"Microsoft Azure Tech Advent Calendar 2024 の 12/13 の投稿記事です。","datePublished":"2024-12-13T00:00:00.000Z","author":{"@type":"Person","name":"ks6088ts","description":"Software Engineer / Solutions Architect","url":"https://github.com/ks6088ts","image":"https://github.com/ks6088ts.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://ks6088ts.github.io/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ks6088ts RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ks6088ts Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0ZTKFXVQ5K"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0ZTKFXVQ5K",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.096f1c7b.css">
<script src="/assets/js/runtime~main.9ca0cf90.js" defer="defer"></script>
<script src="/assets/js/main.3639a821.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="https://github.com/ks6088ts.png"><div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="ナビゲーション" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="ナビゲーションバーを開く" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="https://github.com/ks6088ts.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="https://github.com/ks6088ts.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Home</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ks6088ts/ks6088ts.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="ダークモードを切り替える(現在はライトモード)" aria-label="ダークモードを切り替える(現在はライトモード)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="最近のブログ記事のナビゲーション"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/mcp-get-started">Visual Studio Code Insider と GitHub Copilot agent mode (preview) を使って MCP サーバーを活用する</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/emulate-writing-style-via-github-copilot-edits">GitHub Copilot の Copilot Edits を活用した執筆スタイルのエミュレーション</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/vscode-extension-github-copilot-chat">GitHub Copilot Chat extension 機能を利用した VS Code Extension の開発</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/configure-oidc-azure">GitHub Actions から OpenID Connect で Azure に接続する設定作業を Terraform で自動化する</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/default-community-health-files">GitHub リポジトリのデフォルト設定ファイルを追加する</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">GitHub Actions から OpenID Connect で Azure に接続する設定作業を Terraform で自動化する</h1><div class="container_mt6G margin-vert--md"><time datetime="2024-12-13T00:00:00.000Z">2024年12月13日</time> · <!-- -->約23分</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/ks6088ts" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://github.com/ks6088ts.png" alt="ks6088ts"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/ks6088ts" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">ks6088ts</span></a></div><small class="authorTitle_nd0D" title="Software Engineer / Solutions Architect">Software Engineer / Solutions Architect</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p><a href="https://qiita.com/advent-calendar/2024/microsoft-azure-tech" target="_blank" rel="noopener noreferrer">Microsoft Azure Tech Advent Calendar 2024</a> の 12/13 の投稿記事です。</p>
<p>本記事では、GitHub Actions から OpenID Connect で Azure に接続する設定作業を Terraform で自動化する方法についてご紹介します。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="tldr">TL;DR<a href="#tldr" class="hash-link" aria-label="TL;DR への直接リンク" title="TL;DR への直接リンク">​</a></h2>
<ul>
<li>Terraform を利用して、GitHub Actions から OpenID Connect で Azure に接続するための設定作業を自動化しました</li>
<li>スクリプトと Terraform のサンプルは <a href="https://github.com/ks6088ts-labs/baseline-environment-on-azure-terraform" target="_blank" rel="noopener noreferrer">こちら</a> にて MIT ライセンスで公開しました</li>
<li>GitHub Codespaces と GitHub Actions のイベントトリガーからリソースのデプロイが実行できることを確認しました</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="全体構成">全体構成<a href="#全体構成" class="hash-link" aria-label="全体構成 への直接リンク" title="全体構成 への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="openid-connect-接続設定の自動化">OpenID Connect 接続設定の自動化<a href="#openid-connect-接続設定の自動化" class="hash-link" aria-label="OpenID Connect 接続設定の自動化 への直接リンク" title="OpenID Connect 接続設定の自動化 への直接リンク">​</a></h3>
<p>GitHub Actions から OpenID Connect で Azure に接続するのに必要な設定作業を自動化する流れを示します。<br>
<!-- -->下図では、ローカル開発環境から Terraform を実行して、GitHub と Azure プラットフォーム上に必要な設定流し込むため、以下 2 つのシナリオを実行しています。
シナリオを分けて実行するのは、依存する Terraform provider が異なっていることや、ターゲットとなるプラットフォームが異なることから再利用性を高めるためです。</p>
<ol>
<li><a href="https://github.com/ks6088ts-labs/baseline-environment-on-azure-terraform/blob/main/infra/scenarios/configure_github_secrets/README.md" target="_blank" rel="noopener noreferrer">configure_github_secrets</a>: GitHub 側に Environment Secret を作成する処理が含まれます。</li>
<li><a href="https://github.com/ks6088ts-labs/baseline-environment-on-azure-terraform/blob/main/infra/scenarios/create_service_principal/README.md" target="_blank" rel="noopener noreferrer">create_service_principal</a>: Terraform を使用して、Azure 側にサービスプリンシパルを作成する処理</li>
</ol>
<p><img decoding="async" loading="lazy" src="https://github.com/ks6088ts-labs/baseline-environment-on-azure-terraform/blob/v0.0.1/docs/images/configure_oidc_azure.png?raw=true" alt="configure_oidc_azure.png" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="openid-connect-接続で-github-actions-から-azure-にリソースをデプロイ">OpenID Connect 接続で GitHub Actions から Azure にリソースをデプロイ<a href="#openid-connect-接続で-github-actions-から-azure-にリソースをデプロイ" class="hash-link" aria-label="OpenID Connect 接続で GitHub Actions から Azure にリソースをデプロイ への直接リンク" title="OpenID Connect 接続で GitHub Actions から Azure にリソースをデプロイ への直接リンク">​</a></h3>
<p>上記の設定を行うと、GitHub Actions から OpenID Connect を利用して Azure に接続することができるようになります。
下図では、払い出された接続設定を利用して、GitHub Actions から Azure にリソースをデプロイするシナリオ (e.g. <a href="https://github.com/ks6088ts-labs/baseline-environment-on-azure-terraform/blob/main/infra/scenarios/tfstate_backend/README.md" target="_blank" rel="noopener noreferrer">tfstate_backend</a>) を実行した様子を示しています。</p>
<p><img decoding="async" loading="lazy" src="https://github.com/ks6088ts-labs/baseline-environment-on-azure-terraform/blob/v0.0.1/docs/images/deploy_tfstate_backend.png?raw=true" alt="deploy_tfstate_backend.png" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="github-actions-から-openid-connect-で-azure-に接続する設定作業を手動で行う">GitHub Actions から OpenID Connect で Azure に接続する設定作業を手動で行う<a href="#github-actions-から-openid-connect-で-azure-に接続する設定作業を手動で行う" class="hash-link" aria-label="GitHub Actions から OpenID Connect で Azure に接続する設定作業を手動で行う への直接リンク" title="GitHub Actions から OpenID Connect で Azure に接続する設定作業を手動で行う への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="なぜ-openid-connect-を使って-azure-に接続するのか">なぜ OpenID Connect を使って Azure に接続するのか<a href="#なぜ-openid-connect-を使って-azure-に接続するのか" class="hash-link" aria-label="なぜ OpenID Connect を使って Azure に接続するのか への直接リンク" title="なぜ OpenID Connect を使って Azure に接続するのか への直接リンク">​</a></h3>
<p>まず、<code>GitHub Actions から OpenID Connect で Azure に接続する</code> とはどういうことか説明します。</p>
<p>GitHub と Azure を連携させるために、ここでは GitHub Actions を利用します。GitHub Actions は、GitHub が提供するソフトウェア開発のワークフローを自動化するサービスです。例えば、GitHub リポジトリにプッシュされたコードを自動的にビルド、テスト、デプロイするような CI/CD のユースケースなどに利用されます。</p>
<p>Azure 上で動作するアプリケーションを GitHub Actions からテストしたりデプロイする場合、Azure に接続するための認証が必要です。Azure には様々な認証方法が提供されています。従来は、Azure のサービスプリンシパルを作成し、クライアントシークレットを使って認証する方法が一般的でした。しかし、セキュリティ上の理由から、現在では OpenID Connect を使った認証方法が推奨されています。 (ref. <a href="https://learn.microsoft.com/ja-jp/azure/developer/github/connect-from-azure?tabs=azure-portal%2Clinux" target="_blank" rel="noopener noreferrer">GitHub Actions を使用して Azure に接続する
</a>)</p>
<p>クライアントシークレットのような静的な認証情報は有効期限が長く、漏洩した場合のリスクが高いです。また、キーの管理も煩雑になります。<br>
<!-- -->一方で OpenID Connect を使うと、静的な認証情報を使用せず一時的なトークンで認証を行います。このトークンは有効期限が短く、アクセス元や対象リソースの権限範囲を細かく制限できるため、漏洩してもリスクが低くなります。
そのため、OpenID Connect を使った認証方法が推奨されています。</p>
<p>OpenID Connect を利用するメリットに関しては、<a href="https://amzn.to/3Co02xA" target="_blank" rel="noopener noreferrer">GitHub CI/CD 実践ガイド――持続可能なソフトウェア開発を支える GitHub Actions の設計と運用 エンジニア選書</a>の<code>第11章 OpenID Connectによるセキュアなクラウド連携</code>に詳しく書かれています。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="手動での接続設定は手間がかかるしミスが起きやすい">手動での接続設定は手間がかかるしミスが起きやすい<a href="#手動での接続設定は手間がかかるしミスが起きやすい" class="hash-link" aria-label="手動での接続設定は手間がかかるしミスが起きやすい への直接リンク" title="手動での接続設定は手間がかかるしミスが起きやすい への直接リンク">​</a></h3>
<p>GitHub Actions から OpenID Connect で Azure に接続する設定作業は、手動で行うとざっくりと以下の流れになります。</p>
<p><strong>Azure Portal にて</strong></p>
<ul>
<li>アプリケーション登録する</li>
<li>登録したアプリケーションに対してフェデレーション資格情報を追加する</li>
<li>ロール割り当てを行う</li>
</ul>
<p><strong>GitHub にて</strong></p>
<ul>
<li>リポジトリに環境(=Environment)を作成する</li>
<li>リポジトリで作成した環境上にシークレットを登録する</li>
</ul>
<p>作業手順に関する一次情報は、<a href="https://learn.microsoft.com/azure/developer/github/connect-from-azure?tabs=azure-cli%2Clinux" target="_blank" rel="noopener noreferrer">GitHub Actions を使用して Azure に接続する</a> にあります。<br>
<!-- -->残念なことに私はそれでもよくわからなかったので、調べてみたところ <a href="https://zenn.dev/dzeyelid/articles/5f20acbe549666" target="_blank" rel="noopener noreferrer">Check! GitHub Actions で OpenID Connect(OIDC) で Azure に安全に接続する</a> という記事を見つけました。GUI 操作のスクリーンショット付きで具体的な手順が解説されており、とても参考になりました。</p>
<p><img decoding="async" loading="lazy" src="https://res.cloudinary.com/zenn/image/fetch/s--jeiZgBuE--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_1200/https://storage.googleapis.com/zenn-user-upload/deployed-images/4db01a487f4e1f7e8807f25c.png%3Fsha%3Db18c893e94c6fdeeeb28d1d181bb1d74d1ebbd8e" alt="GitHub Actions で OpenID Connect で Azure に接続する設定" class="img_ev3q"></p>
<p>手動で設定できたのは嬉しいですが、やはり手動での設定は面倒でミスが起きやすいです。実際、この作業を行う過程で何度かミスをしてしまいました。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="面倒で繰り返す作業は自動化すべし">面倒で繰り返す作業は自動化すべし<a href="#面倒で繰り返す作業は自動化すべし" class="hash-link" aria-label="面倒で繰り返す作業は自動化すべし への直接リンク" title="面倒で繰り返す作業は自動化すべし への直接リンク">​</a></h2>
<p>手動でこの作業を行うのは面倒でミスが起きやすいです。<br>
<!-- -->Azure と GitHub を使った CI/CD を含む本格的な開発環境を構築する場合、新しいプロジェクトを立ち上げるたびにこの設定作業を繰り返すことになります。
そのため、将来の自分のために自動化しておくとコストパフォーマンスが良いと感じ、自動化するモチベーションが湧きました。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="アプローチ-1-スクリプトを書いて自動化する">アプローチ 1. スクリプトを書いて自動化する<a href="#アプローチ-1-スクリプトを書いて自動化する" class="hash-link" aria-label="アプローチ 1. スクリプトを書いて自動化する への直接リンク" title="アプローチ 1. スクリプトを書いて自動化する への直接リンク">​</a></h3>
<p>Azure Portal などの Web UI は、ベンダー側の親切心で見た目や操作手順が変わることがあります。スクリーンショットを使った手順書は初心者にとって非常にわかりやすい反面、UI が変わるたびに更新が必要です。一方、フロントエンドが内部的にコールしている API は基本的に後方互換性が保たれることが多いため、API を使った自動化は保守性に優れています。<code>GUIは変わるがAPIは変わらない</code>という考え方は、自動化の観点から重要です。</p>
<p>操作手順を自動化するアプローチとして、正攻法としては UI 操作に対応する API をドキュメントや Copilot を使って調べ、CLI のコマンドやスクリプトに書き起こすことが考えられます。</p>
<p>場合に依ってはドキュメントがない場合もあります。以下のようなブラウザのツールを使ってリクエスト内容をキャプチャし、そこから観測できた挙動を元にスクリプトを書くことも技術的には可能です。
(※ ただし、これはプラットフォーマが明示的に API を定義したものではないため、あまり行儀の良い方法ではなく推奨されません。)</p>
<table><thead><tr><th>ブラウザ</th><th>リンク</th></tr></thead><tbody><tr><td>Microsoft Edge</td><td><a href="https://learn.microsoft.com/ja-jp/microsoft-edge/devtools-guide-chromium/network/" target="_blank" rel="noopener noreferrer">ネットワーク アクティビティの検査</a></td></tr><tr><td>Google Chrome</td><td><a href="https://developer.chrome.com/docs/devtools/network?hl=ja" target="_blank" rel="noopener noreferrer">ネットワーク パネルの使用</a></td></tr></tbody></table>
<p>スクリプトへの書き起こしは一昔前まではウェブ検索して解決していましたが、今は <a href="https://github.com/features/copilot" target="_blank" rel="noopener noreferrer">GitHub Copilot</a>にお任せすると早いです。チャットで聞くもよし、適当なファイル上でコメント補完の形で対話するもよしです。<br>
<!-- -->私は後者の手法をよく使います。やりかたは <a href="https://patterns.hattori.dev/ja/general/comment-to-code/" target="_blank" rel="noopener noreferrer">GitHub Copilot パターン&amp;エクササイズ &gt; コメントからコードを生成</a> を参考にしています。シェルスクリプトで目標としていた Azure と GitHub の設定を自動化するためのスクリプトを書いてみました。</p>
<ul>
<li><a href="https://github.com/ks6088ts-labs/baseline-environment-on-azure-terraform/blob/v0.0.1/scripts/create-service-principal.sh" target="_blank" rel="noopener noreferrer">scripts/create-service-principal.sh</a>: サービスプリンシパルを作成して資格情報・権限割り当てを実行するシェルスクリプト</li>
<li><a href="https://github.com/ks6088ts-labs/baseline-environment-on-azure-terraform/blob/v0.0.1/scripts/configure-github-secrets.sh" target="_blank" rel="noopener noreferrer">scripts/configure-github-secrets.sh</a>: GitHub の環境にシークレットを設定するシェルスクリプト</li>
</ul>
<p>長ったらしいシェルスクリプトではありますが、実行環境の依存関係はコンパクトに纏まっているので身軽に使えそうです。
ただ、途中でエラーが起きたりした場合は手動で修正する必要があるので、完全な自動化とは言えません。再現性にも問題があるので他の人に自信を持って渡すことはできません。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="アプローチ-2-iac-ツールを利用して自動化する">アプローチ 2. IaC ツールを利用して自動化する<a href="#アプローチ-2-iac-ツールを利用して自動化する" class="hash-link" aria-label="アプローチ 2. IaC ツールを利用して自動化する への直接リンク" title="アプローチ 2. IaC ツールを利用して自動化する への直接リンク">​</a></h3>
<p>手順が複雑で重厚長大な成果物を他者に渡す場合は IaC ツールを利用することが多いです。
シェルスクリプトに比べると書くのに手間がかかりますが、再現性や保守性が高いので他者に渡す場合は IaC ツールを利用することが多いです。
IaC ツールとしては大きく Bicep, Terraform などが考えられます。
今回のユースケースにおいては、Azure と GitHub のリソースを管理する必要があるため Terraform が適していると思います。
IaC ツール選定に迷った場合は、<a href="https://learn.microsoft.com/ja-jp/azure/developer/terraform/comparing-terraform-and-bicep?tabs=comparing-bicep-terraform-integration-features#infrastructure-targets" target="_blank" rel="noopener noreferrer">Terraform と Bicep の比較</a> が参考になります。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="terraform-で実装する">Terraform で実装する<a href="#terraform-で実装する" class="hash-link" aria-label="Terraform で実装する への直接リンク" title="Terraform で実装する への直接リンク">​</a></h2>
<p>基本的に CRUD 操作を行う Web API を提供しているプラットフォームには Terraform Provider を実装することができます。
幸い、今回ターゲットとしている各プラットフォーム向けに以下のプロバイダが提供されていますので、それを利用して設定を自動化してみます。</p>
<p>(仮にプロバイダが無い場合は、<a href="https://ks6088ts.github.io/blog/terraform-provider-soracom#2-soracom-%E5%90%91%E3%81%91%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%83%97%E3%83%AD%E3%83%90%E3%82%A4%E3%83%80%E3%81%AE%E5%AE%9F%E8%A3%85" target="_blank" rel="noopener noreferrer">2. SORACOM 向けカスタムプロバイダの実装</a>のような形でフルスクラッチでプロバイダを実装することもできます)</p>
<table><thead><tr><th>プラットフォーム</th><th>プロバイダ</th></tr></thead><tbody><tr><td>GitHub</td><td><a href="https://registry.terraform.io/providers/integrations/github/latest" target="_blank" rel="noopener noreferrer">integrations/github</a></td></tr><tr><td>Microsoft Entra ID(Azure AD)</td><td><a href="https://registry.terraform.io/providers/hashicorp/azuread/latest/docs" target="_blank" rel="noopener noreferrer">hashicorp/azuread</a></td></tr><tr><td>Azure</td><td><a href="https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs" target="_blank" rel="noopener noreferrer">hashicorp/azurerm</a></td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="開発環境を整える">開発環境を整える<a href="#開発環境を整える" class="hash-link" aria-label="開発環境を整える への直接リンク" title="開発環境を整える への直接リンク">​</a></h3>
<p>エディタの拡張機能による決定論的なインテリセンス、GitHub Copilot による生成 AI ベースのインテリセンス、静的解析ツールによる品質保証など、事前に開発環境を整えることで生産性が向上します。</p>
<p>Visual Studio Code 上で開発する場合、VS Code 拡張として以下のものをインストールすると Terraform の開発が捗ります。いずれも HashiCorp が提供しているものです。</p>
<table><thead><tr><th>拡張機能名</th><th>リンク</th></tr></thead><tbody><tr><td>Terraform Extension for Visual Studio Code</td><td><a href="https://marketplace.visualstudio.com/items?itemName=HashiCorp.terraform" target="_blank" rel="noopener noreferrer">HashiCorp Terraform</a></td></tr><tr><td>HCL Extension for Visual Studio Code</td><td><a href="https://marketplace.visualstudio.com/items?itemName=HashiCorp.HCL" target="_blank" rel="noopener noreferrer">HashiCorp HCL</a></td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="静的解析を導入する">静的解析を導入する<a href="#静的解析を導入する" class="hash-link" aria-label="静的解析を導入する への直接リンク" title="静的解析を導入する への直接リンク">​</a></h3>
<p>Terraform のコードに静的解析ツールを導入しておくと、コードの品質を保つのに役立ちます。今回は以下のツールを導入してみました。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="tflint"><strong><a href="https://github.com/terraform-linters/tflint" target="_blank" rel="noopener noreferrer">TFLint</a></strong><a href="#tflint" class="hash-link" aria-label="tflint への直接リンク" title="tflint への直接リンク">​</a></h4>
<p>静的解析ツール。未使用変数とかがあると教えてくれます。例えば以下のように、未使用のデータソースがあることを指摘してくれます。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2 issue(s) found:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Warning: data &quot;azuread_client_config&quot; &quot;client_config&quot; is declared but not used (terraform_unused_declarations)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  on scenarios/create_user_group/main.tf line 26:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  26: data &quot;azuread_client_config&quot; &quot;client_config&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Reference: https://github.com/terraform-linters/tflint-ruleset-terraform/blob/v0.2.2/docs/rules/terraform_unused_declarations.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Warning: data &quot;azuread_service_principal&quot; &quot;msgraph&quot; is declared but not used (terraform_unused_declarations)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  on scenarios/create_user_group/main.tf line 32:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  32: data &quot;azuread_service_principal&quot; &quot;msgraph&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Reference: https://github.com/terraform-linters/tflint-ruleset-terraform/blob/v0.2.2/docs/rules/terraform_unused_declarations.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make: *** [Makefile:52: tflint] Error 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Error: Process completed with exit code 2.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="trivy"><strong><a href="https://github.com/aquasecurity/trivy" target="_blank" rel="noopener noreferrer">Trivy</a></strong><a href="#trivy" class="hash-link" aria-label="trivy への直接リンク" title="trivy への直接リンク">​</a></h4>
<p>Trivy はコンテナイメージの脆弱性スキャンツールですが、Terraform のコードにも適用できます。<br>
<!-- -->セキュリティに関するベストプラクティスに沿っていないコードを指摘してくれます。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="参考-tfsec">(参考) <strong><a href="https://github.com/aquasecurity/tfsec" target="_blank" rel="noopener noreferrer">tfsec</a></strong><a href="#参考-tfsec" class="hash-link" aria-label="参考-tfsec への直接リンク" title="参考-tfsec への直接リンク">​</a></h4>
<p>セキュリティの静的解析ツールですが、現在は非推奨で Trivy に移行することが推奨されています。<br>
<a href="https://github.com/aquasecurity/tfsec/discussions/1994" target="_blank" rel="noopener noreferrer">tfsec is joining the Trivy family #1994</a> によると、tfsec は 2023 年 2 月に Aqua Security 社に買収されており、Trivy ファミリに組み込まれることが発表されています。
<a href="https://zenn.dev/acntechjp/articles/9f0e3d4813e36d#tfsec%E3%81%AE%E7%8F%BE%E7%8A%B6" target="_blank" rel="noopener noreferrer">tfsec から Trivy に移行した話</a> や <a href="https://github.com/aquasecurity/tfsec/blob/master/tfsec-to-trivy-migration-guide.md" target="_blank" rel="noopener noreferrer">Trivy へのマイグレーションガイド</a>が出ている状況も鑑みますと、今後は Trivy を使っていくのが良さそうです。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="どこからでも動かせるようにする">どこからでも動かせるようにする<a href="#どこからでも動かせるようにする" class="hash-link" aria-label="どこからでも動かせるようにする への直接リンク" title="どこからでも動かせるようにする への直接リンク">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="github-codespaces">GitHub Codespaces<a href="#github-codespaces" class="hash-link" aria-label="GitHub Codespaces への直接リンク" title="GitHub Codespaces への直接リンク">​</a></h3>
<p>ブラウザだけで動かせるとなお有難いので、GitHub Codespaces でも実行できるように Dev Container の設定も書いてみました。実際に書いた設定はこちら: <a href="https://github.com/ks6088ts-labs/baseline-environment-on-azure-terraform/blob/v0.0.1/.devcontainer/devcontainer.json" target="_blank" rel="noopener noreferrer">.devcontainer/devcontainer.json</a>。<br>
<a href="https://containers.dev/features" target="_blank" rel="noopener noreferrer">Dev Container Features</a> というコミュニティベースの拡張機能が充実していて、CLI ツールのインストール程度であれば、もはや Dockerfile すら書かなくてもよい感じです。
GitHub Codespace に対応しておけば、開発端末がなくても開発環境を構築できるので、開発環境の構築を手軽に行いたい場合に便利です。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="github-actions-の-workflow_dispatch">GitHub Actions の <code>workflow_dispatch</code><a href="#github-actions-の-workflow_dispatch" class="hash-link" aria-label="github-actions-の-workflow_dispatch への直接リンク" title="github-actions-の-workflow_dispatch への直接リンク">​</a></h3>
<p>ブラウザから GitHub Actions の手動実行を行うためには、<code>workflow_dispatch</code> イベントを利用します。
実際に書いたワークフローは <a href="https://github.com/ks6088ts-labs/baseline-environment-on-azure-terraform/blob/v0.0.1/.github/workflows/deploy.yml" target="_blank" rel="noopener noreferrer">.github/workflows/deploy.yml</a> です。</p>
<p>Environment の活用方法については、<a href="https://aadojo.alterbooth.com/entry/2023/07/17/150000" target="_blank" rel="noopener noreferrer">GitHub Actions で環境(Environment)をパラメーターで指定する</a>が参考になりました。
GitHub Actions の環境(Environment) を使うと、同様の処理を異なる環境に対して実行できます。IT 管理者が開発環境やリソースを払い出す場合にも有用なのでは？と思います。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="実行例">実行例<a href="#実行例" class="hash-link" aria-label="実行例 への直接リンク" title="実行例 への直接リンク">​</a></h2>
<p>実際に GitHub Actions を使用して OpenID Connect で Azure に接続する設定を自動化した Terraform (HCL) コードを実行してみます。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># リポジトリをクローン</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git clone git@github.com:ks6088ts-labs/baseline-environment-on-azure-terraform.git</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-create_service_principal-サービスプリンシパルを作成しopenid-connect-を設定して-azure-に認証します">1. <a href="https://github.com/ks6088ts-labs/baseline-environment-on-azure-terraform/blob/main/infra/scenarios/create_service_principal/README.md" target="_blank" rel="noopener noreferrer">create_service_principal</a>: サービスプリンシパルを作成し、OpenID Connect を設定して Azure に認証します。<a href="#1-create_service_principal-サービスプリンシパルを作成しopenid-connect-を設定して-azure-に認証します" class="hash-link" aria-label="1-create_service_principal-サービスプリンシパルを作成しopenid-connect-を設定して-azure-に認証します への直接リンク" title="1-create_service_principal-サービスプリンシパルを作成しopenid-connect-を設定して-azure-に認証します への直接リンク">​</a></h3>
<p>以下の処理を Terraform で実行します。</p>
<ul>
<li>Microsoft Entra ID に新しいアプリケーションとサービスプリンシパルを作成</li>
<li>必要なリソースアクセス権やロールを割り当てる</li>
<li>GitHub Actions 連携用のフェデレーション認証設定の払い出し</li>
<li>ローカル開発用のクライアントシークレット作成</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ディレクトリに移動</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd infra/scenarios/create_service_principal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Azure CLI でログイン</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">az login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># (オプション) 現在ログインしているアカウントを確認</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">az ad signed-in-user show</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Terraform で利用される環境変数を設定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export ARM_SUBSCRIPTION_ID=$(az account show --query id --output tsv)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export TF_VAR_service_principal_name=&quot;baseline-environment-on-azure-terraform_tf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export TF_VAR_github_environment=&quot;tf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Terraformの設定を初期化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># リソースの作成</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform apply -auto-approve</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>想定通りリソースが作成できているか Azure Portal から確認してみます。
以下では API のアクセス許可設定が確認できます。(管理者の同意は未実施)</p>
<p><img decoding="async" loading="lazy" alt="api_permissions" src="/assets/images/api_permissions-ff1be18140855f4eb77cd626a8ee96ef.png" width="1000" height="671" class="img_ev3q"></p>
<p>GitHub 向けのフェデレーション認証設定が確認できます。</p>
<p><img decoding="async" loading="lazy" alt="federated_credentials" src="/assets/images/federated_credentials-89fb063eb4668dabb344827b2834a14b.png" width="981" height="521" class="img_ev3q"></p>
<p>アプリケーションに権限を付与するためには管理者の同意が必要です。
対象となるアプリケーションのオブジェクト ID は output で出力しておりますので、以下のコマンドで管理者の同意を実施できます。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># アプリケーションに権限を付与</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">application_object_id=$(terraform output -raw application_object_id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">az ad app permission admin-consent --id $application_object_id</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-configure_github_secrets-github-シークレットを設定">2. <a href="https://github.com/ks6088ts-labs/baseline-environment-on-azure-terraform/blob/main/infra/scenarios/configure_github_secrets/README.md" target="_blank" rel="noopener noreferrer">configure_github_secrets</a>: GitHub シークレットを設定<a href="#2-configure_github_secrets-github-シークレットを設定" class="hash-link" aria-label="2-configure_github_secrets-github-シークレットを設定 への直接リンク" title="2-configure_github_secrets-github-シークレットを設定 への直接リンク">​</a></h3>
<p>GitHub CLI の認証情報を利用して、以下の処理を Terraform で実行します。</p>
<ul>
<li>GitHub リポジトリの作成</li>
<li>リポジトリに環境を作成</li>
<li>作成した環境にシークレットを設定</li>
</ul>
<p>1 で作成した Azure の設定を利用して GitHub にシークレットを設定するため、<code>terraform.tfvars</code> に Azure の設定を記述します。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ディレクトリに移動</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd infra/scenarios/configure_github_secrets/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Azure CLI でログイン</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">az login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># (オプション) 現在ログインしているアカウントを確認</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">az ad signed-in-user show</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 作成したアプリケーションの情報を取得</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">APPLICATION_NAME=&quot;baseline-environment-on-azure-terraform_tf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">APPLICATION_ID=$(az ad sp list --display-name &quot;$APPLICATION_NAME&quot; --query &quot;[0].appId&quot; --output tsv)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SUBSCRIPTION_ID=$(az account show --query id --output tsv)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TENANT_ID=$(az account show --query tenantId --output tsv)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># terraform.tfvars に Azure の設定を記述</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF &gt; terraform.tfvars</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">create_github_repository = &quot;false&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">organization = &quot;ks6088ts-labs&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">repository_name = &quot;baseline-environment-on-azure-terraform&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">environment_name = &quot;tf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">actions_environment_secrets = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name  = &quot;ARM_CLIENT_ID&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value = &quot;$APPLICATION_ID&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name  = &quot;ARM_SUBSCRIPTION_ID&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value = &quot;$SUBSCRIPTION_ID&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name  = &quot;ARM_TENANT_ID&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      value = &quot;$TENANT_ID&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name  = &quot;ARM_USE_OIDC&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      value = &quot;true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>上記の設定を利用して、以下の処理を Terraform で実行します。
Terraform で GitHub リポジトリに環境を作成し、環境にシークレットを設定します。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ディレクトリに移動</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd infra/scenarios/configure_github_secrets/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># GitHub CLI でログイン</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gh auth login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># (オプション) 現在ログインしているアカウントを確認</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gh auth status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Terraform の初期化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># リソースの作成</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform apply -auto-approve</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>GitHub リポジトリに環境が作成され、環境にシークレットが設定されていることが確認できます。</p>
<p><img decoding="async" loading="lazy" alt="configure_github_secrets" src="/assets/images/configure_github_secrets-9cbacb03e7c55ecf2b57bf9dc3696abb.png" width="935" height="330" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-github-actions-から-openid-connect-で-azure-に接続してみる">3. GitHub Actions から OpenID Connect で Azure に接続してみる<a href="#3-github-actions-から-openid-connect-で-azure-に接続してみる" class="hash-link" aria-label="3. GitHub Actions から OpenID Connect で Azure に接続してみる への直接リンク" title="3. GitHub Actions から OpenID Connect で Azure に接続してみる への直接リンク">​</a></h3>
<p>手順 1, 手順 2 で作成した設定を利用して、GitHub Actions から OpenID Connect で Azure に接続してみます。</p>
<p><a href="https://github.com/ks6088ts-labs/baseline-environment-on-azure-terraform/blob/v0.0.1/.github/workflows/deploy.yml" target="_blank" rel="noopener noreferrer">.github/workflows/deploy.yml</a> に GitHub Actions のワークフローが定義されています。</p>
<p>GitHub Actions では、input を受け取ることができます。以下のように <code>scenario</code> と <code>environment</code> を指定することで、デプロイ対象のシナリオと環境を選択してワークフローを実行できます。</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">workflow_dispatch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">inputs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># デプロイ対象のシナリオを選択</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">scenario</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">required</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Scenario to deploy&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">default</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tfstate_backend&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 環境を選択</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">required</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Environment to deploy&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">default</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ci&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>上記の設定を作成すると、GitHub のウェブ UI から以下のように手動でワークフローを実行できます。</p>
<p><img decoding="async" loading="lazy" alt="workflow_dispatch" src="/assets/images/workflow_dispatch-834b94a040ca3cb71f9a664f5f6d8c1c.png" width="901" height="630" class="img_ev3q"></p>
<p>実行対象の環境と、環境変数を設定します。</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> github.event.inputs.environment </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ARM_CLIENT_ID</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.ARM_CLIENT_ID </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ARM_SUBSCRIPTION_ID</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.ARM_SUBSCRIPTION_ID </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ARM_TENANT_ID</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.ARM_TENANT_ID </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ARM_USE_OIDC</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">secrets.ARM_USE_OIDC</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>接続に成功すると、Azure にリソースがデプロイされます。実行結果は以下のようになります。</p>
<p><img decoding="async" loading="lazy" alt="github_actions" src="/assets/images/github_actions-269408024cccb09462a7ef77a277b774.png" width="642" height="639" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="まとめ">まとめ<a href="#まとめ" class="hash-link" aria-label="まとめ への直接リンク" title="まとめ への直接リンク">​</a></h2>
<p>本記事では、GitHub Actions から OpenID Connect を利用して Azure に接続する設定を Terraform で自動化する方法をご紹介しました。<br>
<!-- -->この自動化により、開発者は環境構築の手間を省き、本来の開発業務に集中できるようになります。また、手動設定に比べてミスが減り、OpenID Connect を使った認証によりセキュリティリスクも軽減されます。<br>
<!-- -->GitHub Actions を利用して Azure にリソースをデプロイする構成は、ローカル環境からデプロイする場合と異なり、デプロイに必要な権限を GitHub Actions 側に委譲できることから、セキュリティの観点からも有用です。
事業部門が Entra ディレクトリを提供サービス用に外出ししているケースや、開発者がオペレーターを兼ねる場合など、様々なシーンで活用できると思います。</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>タグ:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/azure">azure</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/terraform">terraform</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/github">github</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ブログ記事のナビゲーション"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/vscode-extension-github-copilot-chat"><div class="pagination-nav__sublabel">新しい記事</div><div class="pagination-nav__label">GitHub Copilot Chat extension 機能を利用した VS Code Extension の開発</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/default-community-health-files"><div class="pagination-nav__sublabel">過去の記事</div><div class="pagination-nav__label">GitHub リポジトリのデフォルト設定ファイルを追加する</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#tldr" class="table-of-contents__link toc-highlight">TL;DR</a></li><li><a href="#全体構成" class="table-of-contents__link toc-highlight">全体構成</a><ul><li><a href="#openid-connect-接続設定の自動化" class="table-of-contents__link toc-highlight">OpenID Connect 接続設定の自動化</a></li><li><a href="#openid-connect-接続で-github-actions-から-azure-にリソースをデプロイ" class="table-of-contents__link toc-highlight">OpenID Connect 接続で GitHub Actions から Azure にリソースをデプロイ</a></li></ul></li><li><a href="#github-actions-から-openid-connect-で-azure-に接続する設定作業を手動で行う" class="table-of-contents__link toc-highlight">GitHub Actions から OpenID Connect で Azure に接続する設定作業を手動で行う</a><ul><li><a href="#なぜ-openid-connect-を使って-azure-に接続するのか" class="table-of-contents__link toc-highlight">なぜ OpenID Connect を使って Azure に接続するのか</a></li><li><a href="#手動での接続設定は手間がかかるしミスが起きやすい" class="table-of-contents__link toc-highlight">手動での接続設定は手間がかかるしミスが起きやすい</a></li></ul></li><li><a href="#面倒で繰り返す作業は自動化すべし" class="table-of-contents__link toc-highlight">面倒で繰り返す作業は自動化すべし</a><ul><li><a href="#アプローチ-1-スクリプトを書いて自動化する" class="table-of-contents__link toc-highlight">アプローチ 1. スクリプトを書いて自動化する</a></li><li><a href="#アプローチ-2-iac-ツールを利用して自動化する" class="table-of-contents__link toc-highlight">アプローチ 2. IaC ツールを利用して自動化する</a></li></ul></li><li><a href="#terraform-で実装する" class="table-of-contents__link toc-highlight">Terraform で実装する</a><ul><li><a href="#開発環境を整える" class="table-of-contents__link toc-highlight">開発環境を整える</a></li><li><a href="#静的解析を導入する" class="table-of-contents__link toc-highlight">静的解析を導入する</a></li></ul></li><li><a href="#どこからでも動かせるようにする" class="table-of-contents__link toc-highlight">どこからでも動かせるようにする</a><ul><li><a href="#github-codespaces" class="table-of-contents__link toc-highlight">GitHub Codespaces</a></li><li><a href="#github-actions-の-workflow_dispatch" class="table-of-contents__link toc-highlight">GitHub Actions の <code>workflow_dispatch</code></a></li></ul></li><li><a href="#実行例" class="table-of-contents__link toc-highlight">実行例</a><ul><li><a href="#1-create_service_principal-サービスプリンシパルを作成しopenid-connect-を設定して-azure-に認証します" class="table-of-contents__link toc-highlight">1. create_service_principal: サービスプリンシパルを作成し、OpenID Connect を設定して Azure に認証します。</a></li><li><a href="#2-configure_github_secrets-github-シークレットを設定" class="table-of-contents__link toc-highlight">2. configure_github_secrets: GitHub シークレットを設定</a></li><li><a href="#3-github-actions-から-openid-connect-で-azure-に接続してみる" class="table-of-contents__link toc-highlight">3. GitHub Actions から OpenID Connect で Azure に接続してみる</a></li></ul></li><li><a href="#まとめ" class="table-of-contents__link toc-highlight">まとめ</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/category/projects">Projects</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/privacy-policy">Privacy Policy</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/ks6088ts" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/ks6088ts" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/ks6088ts" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 ks6088ts. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>
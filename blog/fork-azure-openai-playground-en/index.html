<!doctype html>
<html lang="ja-JP" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Building a ChatGPT trial environment using Azure OpenAI Service | ks6088ts</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://github.com/ks6088ts.png"><meta data-rh="true" name="twitter:image" content="https://github.com/ks6088ts.png"><meta data-rh="true" property="og:url" content="https://ks6088ts.github.io/blog/fork-azure-openai-playground-en"><meta data-rh="true" property="og:locale" content="ja_JP"><meta data-rh="true" property="og:locale:alternate" content="en_US"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Building a ChatGPT trial environment using Azure OpenAI Service | ks6088ts"><meta data-rh="true" name="description" content="* This article is translated from Azure OpenAI Service を利用した ChatGPT お試し環境の構築"><meta data-rh="true" property="og:description" content="* This article is translated from Azure OpenAI Service を利用した ChatGPT お試し環境の構築"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-05-01T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/ks6088ts"><meta data-rh="true" property="article:tag" content="azure,azure-ad,azure-openai-service,app-service"><link data-rh="true" rel="icon" href="https://github.com/ks6088ts.png"><link data-rh="true" rel="canonical" href="https://ks6088ts.github.io/blog/fork-azure-openai-playground-en"><link data-rh="true" rel="alternate" href="https://ks6088ts.github.io/blog/fork-azure-openai-playground-en" hreflang="ja-JP"><link data-rh="true" rel="alternate" href="https://ks6088ts.github.io/en/blog/fork-azure-openai-playground-en" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://ks6088ts.github.io/blog/fork-azure-openai-playground-en" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://ks6088ts.github.io/blog/fork-azure-openai-playground-en","mainEntityOfPage":"https://ks6088ts.github.io/blog/fork-azure-openai-playground-en","url":"https://ks6088ts.github.io/blog/fork-azure-openai-playground-en","headline":"Building a ChatGPT trial environment using Azure OpenAI Service","name":"Building a ChatGPT trial environment using Azure OpenAI Service","description":"* This article is translated from Azure OpenAI Service を利用した ChatGPT お試し環境の構築","datePublished":"2023-05-01T00:00:00.000Z","author":{"@type":"Person","name":"ks6088ts","description":"Software Engineer / Solutions Architect","url":"https://github.com/ks6088ts","image":"https://github.com/ks6088ts.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://ks6088ts.github.io/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ks6088ts RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ks6088ts Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0ZTKFXVQ5K"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0ZTKFXVQ5K",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.096f1c7b.css">
<script src="/assets/js/runtime~main.47f3da8a.js" defer="defer"></script>
<script src="/assets/js/main.522124e2.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="https://github.com/ks6088ts.png"><div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="ナビゲーション" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="ナビゲーションバーを開く" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="https://github.com/ks6088ts.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="https://github.com/ks6088ts.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Home</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ks6088ts/ks6088ts.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="ダークモードを切り替える(現在はライトモード)" aria-label="ダークモードを切り替える(現在はライトモード)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="最近のブログ記事のナビゲーション"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/vscode-extension-github-copilot-chat">GitHub Copilot Chat extension 機能を利用した VS Code Extension の開発</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/configure-oidc-azure">GitHub Actions から OpenID Connect で Azure に接続する設定作業を Terraform で自動化する</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/default-community-health-files">GitHub リポジトリのデフォルト設定ファイルを追加する</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/handson-rag-app">Azure 上で作る RAG アプリ開発入門</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/graph-api-summary">Microsoft Graph API 関連情報のまとめ</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">Building a ChatGPT trial environment using Azure OpenAI Service</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-05-01T00:00:00.000Z">2023年5月1日</time> · <!-- -->約8分</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/ks6088ts" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://github.com/ks6088ts.png" alt="ks6088ts"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/ks6088ts" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">ks6088ts</span></a></div><small class="authorTitle_nd0D" title="Software Engineer / Solutions Architect">Software Engineer / Solutions Architect</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><ul>
<li>This article is translated from <a href="/blog/fork-azure-openai-playground">Azure OpenAI Service を利用した ChatGPT お試し環境の構築</a></li>
</ul>
<hr>
<p>We have created a trial environment for ChatGPT using Azure OpenAI Service.<br>
<!-- -->Both OpenAI and Azure OpenAI Service already have easy-to-use web apps for experiencing ChatGPT, and all you need is a browser and an account to try it out.</p>
<ul>
<li>OpenAI: <a href="https://chat.openai.com/" target="_blank" rel="noopener noreferrer">ChatGPT Web App</a>, <a href="https://platform.openai.com/playground" target="_blank" rel="noopener noreferrer">Playground</a></li>
<li>Azure: <a href="https://oai.azure.com/portal" target="_blank" rel="noopener noreferrer">Azure OpenAI Studio</a></li>
</ul>
<p>From the perspective of a personal trial, just using these web applications is sufficient.<br>
<!-- -->However, when considering the use case of trial use within a wide range of organizations with a view to business application, various issues arise.</p>
<p>For example, if you simply obtain an API Token and use it in a direct way, you cannot prevent unauthorized use when the API Token is leaked. Also, if you want to limit users to members of your organization, you will need to authenticate them in some way. If you tackle these issues from scratch, you will have less time to spend on the trial of ChatGPT, which is the original purpose of this project.</p>
<p>Therefore, this article introduces how to build a trial environment for OpenAI API using Azure OpenAI Service with sample code, with a view to using OpenAI API for business PoC.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Overview への直接リンク" title="Overview への直接リンク">​</a></h2>
<p>The following diagram shows the architecture of the trial environment we will build.</p>
<p><img decoding="async" loading="lazy" alt="architecture" src="/assets/images/architecture-dcd49393a7522cc8d86ca946b46bf8af.png" width="3497" height="2282" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="hands-on">Hands on<a href="#hands-on" class="hash-link" aria-label="Hands on への直接リンク" title="Hands on への直接リンク">​</a></h2>
<p>The following steps are required to build the trial environment.</p>
<hr>
<ol>
<li>Create Azure OpenAI Service resource</li>
<li>Develop a Chat app</li>
<li>Deploy to App Service</li>
<li>Add authentication to the web app running on App Service</li>
<li>Add private endpoint settings</li>
<li>Add VNET integration settings for App Service</li>
</ol>
<hr>
<p>The following sections will walk you through these steps.
When you are done, go to the App Service URL and try ChatGPT.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-create-azure-openai-service-resource">1. Create Azure OpenAI Service resource<a href="#1-create-azure-openai-service-resource" class="hash-link" aria-label="1. Create Azure OpenAI Service resource への直接リンク" title="1. Create Azure OpenAI Service resource への直接リンク">​</a></h3>
<p>See <a href="https://learn.microsoft.com/en-us/azure/cognitive-services/openai/how-to/create-resource?pivots=cli" target="_blank" rel="noopener noreferrer">Create a resource and deploy a model using Azure OpenAI
</a> to create Azure OpenAI Service resource.</p>
<p>The <code>Azure OpenAI resource name</code>, <code>deployed model name</code>, and <code>API key</code> will be used later.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-develop-a-chat-app">2. Develop a Chat app<a href="#2-develop-a-chat-app" class="hash-link" aria-label="2. Develop a Chat app への直接リンク" title="2. Develop a Chat app への直接リンク">​</a></h3>
<p>There are many necessary UI components such as chat forms for OpenAI and parameter setting UI for Playground, and writing a front-end app from scratch will take a lot of time.<br>
<!-- -->Since the implementation of a front-end app is not our goal, we will look for a good OSS to achieve our goal in the shortest time possible.</p>
<p>I sorted by Star count on GitHub and scoured some OSS, and could not find the exact app that uses the Azure OpenAI Service, but I did find <a href="https://github.com/Nashex/gpt4-playground" target="_blank" rel="noopener noreferrer">Nashex/gpt4-playground</a>, an OSS clone of OpenAI&#x27;s Playground.</p>
<p>There is a demo site (<a href="https://www.gpt4-playground.com/" target="_blank" rel="noopener noreferrer">GPT-4 Playground</a>), and it seems to be almost in line with the purpose of this project, except that it uses OpenAI&#x27;s API.</p>
<p>If we fork this OSS and modify the code that calls OpenAI API to use Azure OpenAI Service, it should work easily.<br>
<!-- -->The following code is applicable.</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">gpt4-playground/src/utils/OpenAI/OpenAI.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;https://api.openai.com/v1/chat/completions&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    headers</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Authorization</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Bearer </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">token</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;Content-Type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;application/json&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    method</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;POST&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    body</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>By rewriting the <code>Authorization</code> in the fetch destination url and request header to <code>api-key</code>, the same functionality worked with Azure OpenAI Service.</p>
<p>Since I planned to deploy a Docker image in the final stage, I used environment variables to set confidential information such as <code>API KEY</code> and resource names from the outside. <a href="https://nextjs.org/docs/basic-features/environment-variables" target="_blank" rel="noopener noreferrer">Next.js / Environment Variables
</a>.</p>
<p>After confirming that it works in the local environment, write a Dockerfile to containerize it and push it to Docker Hub.</p>
<p>When creating the image, production build for the Next.js app should be applied and place the artifact into the image.</p>
<p>The source code of the forked and modified application is available at <a href="https://github.com/ks6088ts-labs/azure-openai-playground" target="_blank" rel="noopener noreferrer">ks6088ts-labs/azure-openai-playground</a>.</p>
<p>Please note that many parts of the source code have been modified in an ad-hoc manner for the purpose of quick implementation, so please use it only as a reference.</p>
<p>Docker images are available at <a href="https://hub.docker.com/r/ks6088ts/azure-openai-playground" target="_blank" rel="noopener noreferrer">ks6088ts/azure-openai-playground</a>.</p>
<p>If you just want to run the service in local environment, you can check the service operation with the following command</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># run the following command and access to localhost:3000 with your browser</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker run --platform=linux/amd64 --rm \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -p &quot;3000:3000&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --env &quot;AZURE_OPENAI_API_KEY=&lt;YOUR API KEY&gt;&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --env &quot;AZURE_OPENAI_NAME=&lt;YOUR AOAI NAME&gt;&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --env &quot;AZURE_OPENAI_DEPLOYMENT_NAME=&lt;YOUR DEPLOYMENT NAME&gt;&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --env &quot;AZURE_OPENAI_API_VERSION=$(AZURE_OPENAI_API_VERSION)&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ks6088ts/azure-openai-playground:0.0.5</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-deploy-to-app-service">3. Deploy to App Service<a href="#3-deploy-to-app-service" class="hash-link" aria-label="3. Deploy to App Service への直接リンク" title="3. Deploy to App Service への直接リンク">​</a></h3>
<p>The app implemented in step 2 will be published on the Azure App Service.
In this scenario, the Docker container image in the Docker Hub will be pulled and published to the App Service.</p>
<p>Execute the following commands in the Azure CLI.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># create resource group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">az group create \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --name $RESOURCE_GROUP_NAME \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --location japaneast</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># create App Service Plan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">az appservice plan create \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --name $APP_SERVICE_PLAN_NAME \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --resource-group $RESOURCE_GROUP_NAME \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --location japaneast \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --sku B1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --is-linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># create App Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">az webapp create \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --name $APP_SERVICE_NAME \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --plan $APP_SERVICE_PLAN_NAME \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --resource-group $RESOURCE_GROUP_NAME \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --deployment-container-image-name $CONTAINER_IMAGE_NAME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># set environment variables for App Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">az webapp config appsettings set \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --name $APP_SERVICE_NAME \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --resource-group $RESOURCE_GROUP_NAME \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --settings \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        WEBSITES_PORT=3000 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AZURE_OPENAI_API_KEY=$AZURE_OPENAI_API_KEY \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AZURE_OPENAI_NAME=$AZURE_OPENAI_NAME \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AZURE_OPENAI_DEPLOYMENT_NAME=$AZURE_OPENAI_DEPLOYMENT_NAME \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AZURE_OPENAI_API_VERSION=$AZURE_OPENAI_API_VERSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># restart App Service to reflect the environment variables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">az webapp restart \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --name $APP_SERVICE_NAME \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --resource-group $RESOURCE_GROUP_NAME</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now, when you access the App Service URL, it should work the same way it did when you ran it locally earlier.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-add-authentication-to-the-web-app-running-on-app-service">4. Add authentication to the web app running on App Service<a href="#4-add-authentication-to-the-web-app-running-on-app-service" class="hash-link" aria-label="4. Add authentication to the web app running on App Service への直接リンク" title="4. Add authentication to the web app running on App Service への直接リンク">​</a></h3>
<p>Since the App Service supports built-in authentication (=EasyAuth) and authorization, you can have users sign in without writing any code in your web app.<br>
<!-- -->For instructions, see <a href="https://learn.microsoft.com/en-us/azure/app-service/scenario-secure-app-authentication-app-service" target="_blank" rel="noopener noreferrer">Tutorial: Add app authentication to your web app running on Azure App Service</a>.<br>
<!-- -->Simply follow <code>AppService &gt; Authentication &gt; Add identity provider</code> from the Azure Portal to add the desired authentication provider. The major authentication providers are supported, so it is easy to add authentication functionality.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-add-private-endpoint-settings">5. Add private endpoint settings<a href="#5-add-private-endpoint-settings" class="hash-link" aria-label="5. Add private endpoint settings への直接リンク" title="5. Add private endpoint settings への直接リンク">​</a></h3>
<p>Configure Azure OpenAI Service to be available only for private network connections via Azure Virtual Network (VNet).
By limiting requests to those made via the private network, you can prevent unauthorized use of resources from outside, even in the unlikely event that the API Key is leaked.<br>
<!-- -->For instructions, please refer to <a href="https://blog.jbs.co.jp/entry/2023/04/07/173940" target="_blank" rel="noopener noreferrer">Azure OpenAIにプライベートエンドポイント（Private Endpoint）を設定して東日本リージョンの仮想ネットワークのみから使う</a> (*This article is in Japanese, unfortunately).
Following the article, I performed the following operation from Azure Portal and confirmed that the API cannot be called from Azure OpenAI Playground, as expected.</p>
<ul>
<li>Check <code>Azure OpenAI &gt; Networking &gt; Firewalls and virtual networks &gt; Disabled</code> and then activate Private Endpoint</li>
<li>Create Private Endpoint from <code>Azure OpenAI &gt; Networking &gt; Private endpoint connections &gt; + Private endpoint</code></li>
</ul>
<p>Note that the network settings are not immediately reflected, so you need to wait a bit before checking. When I hurriedly checked, it was not reflected and I got stuck...<br>
<!-- -->To confirm content of the API response, you can simply use <code>curl</code> to call the REST API.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl &quot;https://${AOAI_NAME}.openai.azure.com/openai/deployments/${MODEL_NAME}/completions?api-version=2022-12-01&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &#x27;api-key: your-api-key&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &#x27;content-type: application/json&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --data-raw &#x27;{&quot;prompt&quot;:&quot;Write a product launch email for new AI-powered headphones that are priced at $79.99 and available at Best Buy, Target and Amazon.com. The target audience is tech-savvy music lovers and the tone is friendly and exciting.\n\n1. What should be the subject line of the email?  \n2. What should be the body of the email?&quot;,&quot;temperature&quot;:1,&quot;top_p&quot;:1,&quot;frequency_penalty&quot;:0,&quot;presence_penalty&quot;:0,&quot;max_tokens&quot;:350,&quot;stop&quot;:null,&quot;stream&quot;:true}&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --compressed -vvvv</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It seems that Private Endpoint is indeed enabled, since the following parameters were also found in the response.</p>
<ul>
<li><code>policy-id: ThrowExceptionDueToTrafficDenied</code></li>
<li><code>{&quot;error&quot;:{&quot;code&quot;:&quot;AccessDenied&quot;,&quot;message&quot;: &quot;Public access is disabled. Please configure private endpoint.&quot;}}</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-add-vnet-integration-settings-for-app-service">6. Add VNet integration settings for App Service<a href="#6-add-vnet-integration-settings-for-app-service" class="hash-link" aria-label="6. Add VNet integration settings for App Service への直接リンク" title="6. Add VNet integration settings for App Service への直接リンク">​</a></h3>
<p>Enable VNet integration in the Outbound communication settings of the App Service and configure it to send requests from the App Service to the Azure OpenAI Service via VNet.
Refer to <a href="https://techblog.ap-com.co.jp/entry/2021/03/12/150117" target="_blank" rel="noopener noreferrer">【Azure】App ServiceのVNet統合とプライベートリンクを利用した通信閉域化</a>(*This article is in Japanese, unfortunately) and set <code>AppService &gt; Networking &gt; Outbound Traffic &gt; VNet integration &gt; + Add VNet</code> to add VNet.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Summary への直接リンク" title="Summary への直接リンク">​</a></h2>
<p>After following the steps described in the article, the following behavior has been confirmed</p>
<ul>
<li>Unauthenticated users are redirected to the authentication screen of the given authentication provider</li>
<li>Upon successful authentication, users can access to the web app</li>
<li>Azure OpenAI Service responds to the text sent from the chat form</li>
<li>API requests failed from Azure OpenAI Playground, which is outside the VNet</li>
</ul>
<p>This article summarizes the steps to use Azure OpenAI Service from the App Service.
By using the App Service&#x27;s built-in authentication and Vnet integration, we were able to build a secure environment to use Azure OpenAI Service without any hassle.</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>タグ:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/azure">azure</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/azure-ad">azure-ad</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/azure-openai-service">azure-openai-service</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/app-service">app-service</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ブログ記事のナビゲーション"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/fork-azure-openai-playground"><div class="pagination-nav__sublabel">新しい記事</div><div class="pagination-nav__label">Azure OpenAI Service を利用した ChatGPT お試し環境の構築</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/powershell-get-started"><div class="pagination-nav__sublabel">過去の記事</div><div class="pagination-nav__label">PowerShell 開発入門</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#hands-on" class="table-of-contents__link toc-highlight">Hands on</a><ul><li><a href="#1-create-azure-openai-service-resource" class="table-of-contents__link toc-highlight">1. Create Azure OpenAI Service resource</a></li><li><a href="#2-develop-a-chat-app" class="table-of-contents__link toc-highlight">2. Develop a Chat app</a></li><li><a href="#3-deploy-to-app-service" class="table-of-contents__link toc-highlight">3. Deploy to App Service</a></li><li><a href="#4-add-authentication-to-the-web-app-running-on-app-service" class="table-of-contents__link toc-highlight">4. Add authentication to the web app running on App Service</a></li><li><a href="#5-add-private-endpoint-settings" class="table-of-contents__link toc-highlight">5. Add private endpoint settings</a></li><li><a href="#6-add-vnet-integration-settings-for-app-service" class="table-of-contents__link toc-highlight">6. Add VNet integration settings for App Service</a></li></ul></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/category/projects">Projects</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/privacy-policy">Privacy Policy</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/ks6088ts" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/ks6088ts" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/ks6088ts" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 ks6088ts. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>